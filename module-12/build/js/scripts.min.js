"use strict";var form=document.querySelector(".js-form"),inputLink=document.querySelector("input[name=link]"),addBtn=document.querySelector(".form button"),container=document.querySelector("#root"),sourse=document.querySelector("#card").innerHTML.trim(),constants={links:[],delBtn:document.querySelector("#root")};function onClickDel(t){var n=t.target,e=n.nodeName,r=n.dataset.action;if("BUTTON"===e&&"delete"===r){var a=t.target.parentNode,i=Number(t.target.parentNode.dataset.id),o=constants.links.filter(function(t){return t.id!==i});constants.links=o,localStorage.setItem("links",JSON.stringify(constants.links)),a.remove(),console.log("constants.links",constants.links)}}function onClickAdd(t){var n=t.target,e=n.dataset.action;"BUTTON"===n.nodeName&&"add"===e&&(t.preventDefault(),isEnteredUrlValid(),form.reset(),constants.delBtn=document.querySelector(".link-card button"),getLinkData().then(function(t){console.log("data",t);var n=document.querySelector("li img"),e=document.querySelector("li a");n.setAttribute("src",""+t.image),e.textContent=t.title,constants.links[0].img=t.image,constants.links[0].title=t.title,localStorage.setItem("links",JSON.stringify(constants.links))}),localStorage.setItem("links",JSON.stringify(constants.links)))}function isEnteredUrlValid(){var t=inputLink.value.trim();if(!/^((https?|ftp)\:\/\/)/.test(t))return alert("Your URL is not valid");if(constants.links.some(function(t){return t.link===inputLink.value.trim()}))return alert("Such a bookmark already exists");var n={link:inputLink.value.trim(),id:Date.now()};constants.links.unshift(n),console.log("constants.links:",constants.links),createTemplate(),constants.links}function createTemplate(){var t=Handlebars.compile(sourse)(constants.links[0]);container.insertAdjacentHTML("afterbegin",t)}function createTemplateFromLs(){var t=JSON.parse(localStorage.getItem("links"));if(null!==t){constants.links=t;var n=Handlebars.compile(sourse),e=constants.links.reduce(function(t,e){return t+n(e)},"");container.insertAdjacentHTML("afterbegin",e)}}function getLinkData(){var t=constants.links[0].link;return fetch("http://api.linkpreview.net/?key=5ba0af33f2af89d0737b612698e2451865b0a0af180af&q="+t).then(function(t){if(t.ok)return t.json();throw new Error("Error while fetching: "+t.statusText)}).catch(function(t){return console.log(t)})}createTemplateFromLs(),addBtn.addEventListener("click",onClickAdd),constants.delBtn.addEventListener("click",onClickDel);