"use strict";var form=document.querySelector(".js-form"),inputLink=document.querySelector("input[name=link]"),addBtn=document.querySelector(".form button"),container=document.querySelector("#root"),sourse=document.querySelector("#card").innerHTML.trim(),constants={links:[],delBtn:document.querySelector("#root")};function onClickDel(t){var n=t.target,e=n.nodeName,a=n.dataset.action;if("BUTTON"===e&&"delete"===a){var o=t.target.parentNode,r=Number(t.target.parentNode.dataset.id),i=constants.links.filter(function(t){return t.id!==r});constants.links=i,setLocalStorage(),o.remove(),console.log("constants.links",constants.links)}}function onClickAdd(t){var n=t.target,e=n.dataset.action;"BUTTON"===n.nodeName&&"add"===e&&(t.preventDefault(),isEnteredUrlValid(),getLinkData().then(function(t){console.log("data",t);var n={link:inputLink.value.trim(),id:Date.now(),img:t.image,title:t.title};constants.links.unshift(n),createTemplate(),console.log("constants.links:",constants.links),setLocalStorage(),form.reset()}))}function isEnteredUrlValid(){var t=inputLink.value.trim(),n=/^((https?|ftp)\:\/\/)/.test(t),e=constants.links.some(function(t){return t.link===inputLink.value.trim()});return console.log("constants.links befor validation",constants.links),console.log("isLinkValid",e),n?e?alert("Such a bookmark already exists"):void 0:alert("Your URL is not valid")}function createTemplate(){var t=Handlebars.compile(sourse)(constants.links[0]);container.insertAdjacentHTML("afterbegin",t)}function createTemplateFromLs(){var t=JSON.parse(localStorage.getItem("links"));if(null!==t){constants.links=t;var n=Handlebars.compile(sourse),e=constants.links.reduce(function(t,e){return t+n(e)},"");container.insertAdjacentHTML("afterbegin",e)}}function getLinkData(){var t=inputLink.value.trim();return fetch("http://api.linkpreview.net/?key=5ba0af33f2af89d0737b612698e2451865b0a0af180af&q="+t).then(function(t){if(t.ok)return t.json();throw new Error("Error while fetching: "+t.statusText)}).catch(function(t){return console.log(t)})}function setLocalStorage(){localStorage.setItem("links",JSON.stringify(constants.links))}createTemplateFromLs(),addBtn.addEventListener("click",onClickAdd),constants.delBtn.addEventListener("click",onClickDel);